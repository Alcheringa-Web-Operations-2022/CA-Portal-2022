{% extends '../basic.html'%}
{%block title%}Alcheringa {%endblock%}
{% block body %}

<section class="gradient-custom" style="height:100vh;">
	<div class="container py-5 h-100">
		<div class="row justify-content-center align-items-center h-100">
			<div class="col-12 col-lg-9 col-xl-7">
				<div class="card shadow-2-strong card-registration" style="border-radius: 15px; border:10px solid #d17a00">
					<div class="card-body p-4 p-md-5">

						<h3 class="mb-4 pb-2 pb-md-0 mb-md-5">Alcheringa Campus Ambassador</h3>
						<form method="POST">{% csrf_token %}
							{% csrf_token %}
							<div class="input-group mb-3">
								<div class="input-group-append">
									<span class="input-group-text"><i class="fas fa-user"></i></span>
								</div>
								<input type="email" name="email" placeholder="Email..." class="form-control" required>
							</div>
							<div class="input-group mb-2">
								<div class="input-group-append">
									<span class="input-group-text"><i class="fas fa-key"></i></span>
								</div>
								<input type="password" name="password" placeholder="Password..." class="form-control" required>
							</div>
							
							<div class="d-flex justify-content-center mt-3 login_container">
								<input class="btn btn-warning btn-md" style="width: 184px;" type="submit" value="Login">
							</div>

						</form>
                        <div class="d-flex justify-content-center mt-2">
                            <div class="google-btn" id="customBtn">
                                <div class="google-icon-wrapper">
                                    <img class="google-icon" src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"/>
                                </div>
                                <p class="btn-text"><b>Sign in with google</b></p>
                            </div>
                        </div>
						<div class="d-flex justify-content-center mt-3">
							Do not have an account? <a href="{% url 'register' %}" class="ml-2 link-warning">Register</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
<script>startApp();</script>
{% endblock %}
{% block script %}
<script>
  var googleUser = {};
  var startApp = function() {
    gapi.load('auth2', function(){
      // Retrieve the singleton for the GoogleAuth library and set up the client.
      auth2 = gapi.auth2.init({
        client_id: '764894753807-svtfck5d56i3od79g1paj5ls6amkms0p.apps.googleusercontent.com',
        cookiepolicy: 'single_host_origin',
        // Request scopes in addition to 'profile' and 'email'
        //scope: 'additional_scope'
      });
      attachSignin(document.getElementById('customBtn'));
    });
  };

  function attachSignin(element) {
    console.log(element.id);
    auth2.attachClickHandler(element, {},
        async function(googleUser) {
            const firstname=googleUser.getBasicProfile().getName();
            const email=googleUser.getBasicProfile().getEmail();
            $.ajax({
                url: '/users/googleauth/',
                data: {
                    'email': email,
                    'firstname':firstname 
                },
                success: function(data) {
                    alert(data);
                    location.replace('/')
                },
                error: function() {
                    alert('An unknown error has occured. Try again.');
                }
            });
        }, function(error) {
          alert(JSON.stringify(error, undefined, 2));
        });
  }
</script>
{% endblock %}